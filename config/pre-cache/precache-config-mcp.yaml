apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: precache-storage-mcp
spec:
  config:
    ignition:
      version: 3.2.0
    systemd:
      units:
      - contents: |
          [Unit]
          Description=Create a directory to serve as an additional container storage
          ConditionPathExists=!/var/precached

          [Service]
          Type=oneshot
          RemainAfterExit=no
          ExecStart=/bin/mkdir -p /var/precached/overlay-images /var/precached/overlay-layers
          ExecStartPost=/bin/touch /var/precached/overlay-images/images.lock /var/precached/overlay-layers/layers.lock

          [Install]
          WantedBy=multi-user.target
        enabled: true
        name: precached-storage.service
    storage:
      files:
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyBUaGlzIGZpbGUgaXMgZ2VuZXJhdGVkIGJ5IHRoZSBNYWNoaW5lIENvbmZpZyBPcGVyYXRvcidzIGNvbnRhaW5lcnJ1bnRpbWVjb25maWcgY29udHJvbGxlci4KIwojIHN0b3JhZ2UuY29uZiBpcyB0aGUgY29uZmlndXJhdGlvbiBmaWxlIGZvciBhbGwgdG9vbHMKIyB0aGF0IHNoYXJlIHRoZSBjb250YWluZXJzL3N0b3JhZ2UgbGlicmFyaWVzCiMgU2VlIG1hbiA1IGNvbnRhaW5lcnMtc3RvcmFnZS5jb25mIGZvciBtb3JlIGluZm9ybWF0aW9uCiMgVGhlICJjb250YWluZXIgc3RvcmFnZSIgdGFibGUgY29udGFpbnMgYWxsIG9mIHRoZSBzZXJ2ZXIgb3B0aW9ucy4KW3N0b3JhZ2VdCgojIERlZmF1bHQgU3RvcmFnZSBEcml2ZXIKZHJpdmVyID0gIm92ZXJsYXkiCgojIFRlbXBvcmFyeSBzdG9yYWdlIGxvY2F0aW9uCnJ1bnJvb3QgPSAiL3Zhci9ydW4vY29udGFpbmVycy9zdG9yYWdlIgoKIyBQcmltYXJ5IFJlYWQvV3JpdGUgbG9jYXRpb24gb2YgY29udGFpbmVyIHN0b3JhZ2UKZ3JhcGhyb290ID0gIi92YXIvbGliL2NvbnRhaW5lcnMvc3RvcmFnZSIKCltzdG9yYWdlLm9wdGlvbnNdCiMgU3RvcmFnZSBvcHRpb25zIHRvIGJlIHBhc3NlZCB0byB1bmRlcmx5aW5nIHN0b3JhZ2UgZHJpdmVycwoKIyBBZGRpdGlvbmFsSW1hZ2VTdG9yZXMgaXMgdXNlZCB0byBwYXNzIHBhdGhzIHRvIGFkZGl0aW9uYWwgUmVhZC9Pbmx5IGltYWdlIHN0b3JlcwojIE11c3QgYmUgY29tbWEgc2VwYXJhdGVkIGxpc3QuCmFkZGl0aW9uYWxpbWFnZXN0b3JlcyA9IFsKICAgICcvdmFyL3ByZWNhY2hlZCcKXQoKIyBTaXplIGlzIHVzZWQgdG8gc2V0IGEgbWF4aW11bSBzaXplIG9mIHRoZSBjb250YWluZXIgaW1hZ2UuICBPbmx5IHN1cHBvcnRlZCBieQojIGNlcnRhaW4gY29udGFpbmVyIHN0b3JhZ2UgZHJpdmVycy4Kc2l6ZSA9ICIiCgojIE92ZXJyaWRlS2VybmVsQ2hlY2sgdGVsbHMgdGhlIGRyaXZlciB0byBpZ25vcmUga2VybmVsIGNoZWNrcyBiYXNlZCBvbiBrZXJuZWwgdmVyc2lvbgpvdmVycmlkZV9rZXJuZWxfY2hlY2sgPSAidHJ1ZSIKCiMgUmVtYXAtVUlEcy9HSURzIGlzIHRoZSBtYXBwaW5nIGZyb20gVUlEcy9HSURzIGFzIHRoZXkgc2hvdWxkIGFwcGVhciBpbnNpZGUgb2YKIyBhIGNvbnRhaW5lciwgdG8gVUlEcy9HSURzIGFzIHRoZXkgc2hvdWxkIGFwcGVhciBvdXRzaWRlIG9mIHRoZSBjb250YWluZXIsIGFuZAojIHRoZSBsZW5ndGggb2YgdGhlIHJhbmdlIG9mIFVJRHMvR0lEcy4gIEFkZGl0aW9uYWwgbWFwcGVkIHNldHMgY2FuIGJlIGxpc3RlZAojIGFuZCB3aWxsIGJlIGhlZWRlZCBieSBsaWJyYXJpZXMsIGJ1dCB0aGVyZSBhcmUgbGltaXRzIHRvIHRoZSBudW1iZXIgb2YKIyBtYXBwaW5ncyB3aGljaCB0aGUga2VybmVsIHdpbGwgYWxsb3cgd2hlbiB5b3UgbGF0ZXIgYXR0ZW1wdCB0byBydW4gYQojIGNvbnRhaW5lci4KIwojIHJlbWFwLXVpZHMgPSAwOjE2Njg0NDI0Nzk6NjU1MzYKIyByZW1hcC1naWRzID0gMDoxNjY4NDQyNDc5OjY1NTM2CgojIFJlbWFwLVVzZXIvR3JvdXAgaXMgYSBuYW1lIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGxvb2sgdXAgb25lIG9yIG1vcmUgVUlEL0dJRAojIHJhbmdlcyBpbiB0aGUgL2V0Yy9zdWJ1aWQgb3IgL2V0Yy9zdWJnaWQgZmlsZS4gIE1hcHBpbmdzIGFyZSBzZXQgdXAgc3RhcnRpbmcKIyB3aXRoIGFuIGluLWNvbnRhaW5lciBJRCBvZiAwIGFuZCB0aGUgYSBob3N0LWxldmVsIElEIHRha2VuIGZyb20gdGhlIGxvd2VzdAojIHJhbmdlIHRoYXQgbWF0Y2hlcyB0aGUgc3BlY2lmaWVkIG5hbWUsIGFuZCB1c2luZyB0aGUgbGVuZ3RoIG9mIHRoYXQgcmFuZ2UuCiMgQWRkaXRpb25hbCByYW5nZXMgYXJlIHRoZW4gYXNzaWduZWQsIHVzaW5nIHRoZSByYW5nZXMgd2hpY2ggc3BlY2lmeSB0aGUKIyBsb3dlc3QgaG9zdC1sZXZlbCBJRHMgZmlyc3QsIHRvIHRoZSBsb3dlc3Qgbm90LXlldC1tYXBwZWQgY29udGFpbmVyLWxldmVsIElELAojIHVudGlsIGFsbCBvZiB0aGUgZW50cmllcyBoYXZlIGJlZW4gdXNlZCBmb3IgbWFwcy4KIwojIHJlbWFwLXVzZXIgPSAic3RvcmFnZSIKIyByZW1hcC1ncm91cCA9ICJzdG9yYWdlIgoKW3N0b3JhZ2Uub3B0aW9ucy50aGlucG9vbF0KIyBTdG9yYWdlIE9wdGlvbnMgZm9yIHRoaW5wb29sCgojIGF1dG9leHRlbmRfcGVyY2VudCBkZXRlcm1pbmVzIHRoZSBhbW91bnQgYnkgd2hpY2ggcG9vbCBuZWVkcyB0byBiZQojIGdyb3duLiBUaGlzIGlzIHNwZWNpZmllZCBpbiB0ZXJtcyBvZiAlIG9mIHBvb2wgc2l6ZS4gU28gYSB2YWx1ZSBvZiAyMCBtZWFucwojIHRoYXQgd2hlbiB0aHJlc2hvbGQgaXMgaGl0LCBwb29sIHdpbGwgYmUgZ3Jvd24gYnkgMjAlIG9mIGV4aXN0aW5nCiMgcG9vbCBzaXplLgojIGF1dG9leHRlbmRfcGVyY2VudCA9ICIyMCIKCiMgYXV0b2V4dGVuZF90aHJlc2hvbGQgZGV0ZXJtaW5lcyB0aGUgcG9vbCBleHRlbnNpb24gdGhyZXNob2xkIGluIHRlcm1zCiMgb2YgcGVyY2VudGFnZSBvZiBwb29sIHNpemUuIEZvciBleGFtcGxlLCBpZiB0aHJlc2hvbGQgaXMgNjAsIHRoYXQgbWVhbnMgd2hlbgojIHBvb2wgaXMgNjAlIGZ1bGwsIHRocmVzaG9sZCBoYXMgYmVlbiBoaXQuCiMgYXV0b2V4dGVuZF90aHJlc2hvbGQgPSAiODAiCgojIGJhc2VzaXplIHNwZWNpZmllcyB0aGUgc2l6ZSB0byB1c2Ugd2hlbiBjcmVhdGluZyB0aGUgYmFzZSBkZXZpY2UsIHdoaWNoCiMgbGltaXRzIHRoZSBzaXplIG9mIGltYWdlcyBhbmQgY29udGFpbmVycy4KIyBiYXNlc2l6ZSA9ICIxMEciCgojIGJsb2Nrc2l6ZSBzcGVjaWZpZXMgYSBjdXN0b20gYmxvY2tzaXplIHRvIHVzZSBmb3IgdGhlIHRoaW4gcG9vbC4KIyBibG9ja3NpemU9IjY0ayIKCiMgZGlyZWN0bHZtX2RldmljZSBzcGVjaWZpZXMgYSBjdXN0b20gYmxvY2sgc3RvcmFnZSBkZXZpY2UgdG8gdXNlIGZvciB0aGUKIyB0aGluIHBvb2wuIFJlcXVpcmVkIGlmIHlvdSBzZXR1cCBkZXZpY2VtYXBwZXIKIyBkaXJlY3Rsdm1fZGV2aWNlID0gIiIKCiMgZGlyZWN0bHZtX2RldmljZV9mb3JjZSB3aXBlcyBkZXZpY2UgZXZlbiBpZiBkZXZpY2UgYWxyZWFkeSBoYXMgYSBmaWxlc3lzdGVtCiMgZGlyZWN0bHZtX2RldmljZV9mb3JjZSA9ICJUcnVlIgoKIyBmcyBzcGVjaWZpZXMgdGhlIGZpbGVzeXN0ZW0gdHlwZSB0byB1c2UgZm9yIHRoZSBiYXNlIGRldmljZS4KIyBmcz0ieGZzIgoKIyBsb2dfbGV2ZWwgc2V0cyB0aGUgbG9nIGxldmVsIG9mIGRldmljZW1hcHBlci4KIyAwOiBMb2dMZXZlbFN1cHByZXNzIDAgKERlZmF1bHQpCiMgMjogTG9nTGV2ZWxGYXRhbAojIDM6IExvZ0xldmVsRXJyCiMgNDogTG9nTGV2ZWxXYXJuCiMgNTogTG9nTGV2ZWxOb3RpY2UKIyA2OiBMb2dMZXZlbEluZm8KIyA3OiBMb2dMZXZlbERlYnVnCiMgbG9nX2xldmVsID0gIjciCgojIG1pbl9mcmVlX3NwYWNlIHNwZWNpZmllcyB0aGUgbWluIGZyZWUgc3BhY2UgcGVyY2VudCBpbiBhIHRoaW4gcG9vbCByZXF1aXJlIGZvcgojIG5ldyBkZXZpY2UgY3JlYXRpb24gdG8gc3VjY2VlZC4gVmFsaWQgdmFsdWVzIGFyZSBmcm9tIDAlIC0gOTklLgojIFZhbHVlIDAlIGRpc2FibGVzCiMgbWluX2ZyZWVfc3BhY2UgPSAiMTAlIgoKIyBta2ZzYXJnIHNwZWNpZmllcyBleHRyYSBta2ZzIGFyZ3VtZW50cyB0byBiZSB1c2VkIHdoZW4gY3JlYXRpbmcgdGhlIGJhc2UKIyBkZXZpY2UuCiMgbWtmc2FyZyA9ICIiCgojIG1vdW50b3B0IHNwZWNpZmllcyBleHRyYSBtb3VudCBvcHRpb25zIHVzZWQgd2hlbiBtb3VudGluZyB0aGUgdGhpbiBkZXZpY2VzLgojIG1vdW50b3B0ID0gIiIKCiMgdXNlX2RlZmVycmVkX3JlbW92YWwgTWFya2luZyBkZXZpY2UgZm9yIGRlZmVycmVkIHJlbW92YWwKIyB1c2VfZGVmZXJyZWRfcmVtb3ZhbCA9ICJUcnVlIgoKIyB1c2VfZGVmZXJyZWRfZGVsZXRpb24gTWFya2luZyBkZXZpY2UgZm9yIGRlZmVycmVkIGRlbGV0aW9uCiMgdXNlX2RlZmVycmVkX2RlbGV0aW9uID0gIlRydWUiCgojIHhmc19ub3NwYWNlX21heF9yZXRyaWVzIHNwZWNpZmllcyB0aGUgbWF4aW11bSBudW1iZXIgb2YgcmV0cmllcyBYRlMgc2hvdWxkCiMgYXR0ZW1wdCB0byBjb21wbGV0ZSBJTyB3aGVuIEVOT1NQQyAobm8gc3BhY2UpIGVycm9yIGlzIHJldHVybmVkIGJ5CiMgdW5kZXJseWluZyBzdG9yYWdlIGRldmljZS4KIyB4ZnNfbm9zcGFjZV9tYXhfcmV0cmllcyA9ICIwIgo=
        mode: 493
        path: /etc/containers/storage.conf
        overwrite: true
